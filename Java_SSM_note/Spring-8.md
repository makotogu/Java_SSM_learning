# Spring的AOP简介

## AOP的作用及其优势

* 作用：在程序运行期间在不修改源码的情况下对方法进行功能增强
* 优势：减少重复代码，调高开发效率，并且便于维护

## JDK的动态代理

## cglib的动态代理

## AOP相关概念

* Target（目标对象）：代理的目标对象
* Proxy（代理）：一个类被AOP织入增强后，就产生一个结果代理类
* Joinpoint（连接点）：所谓的连接点就是被拦截到的点，在Spring中点指的是方法，因为Spring只支持方法类型的连接点
* Pointcut（切入点）：所谓切入点是我们要对哪些Joinpoint进行拦截的定义
* Advice（通知/增强）：所谓通知就是兰街道Joinpoint后要做的十强
* Aspect（切面）：是切入点和通知的结合
* Weaving（织入）：是吧增强应用到目标对象来创建新的代理对象的过程，spring采用动态代理织入，而AspectJ采用编译器织入和类装载期织入

## AOP开发明确的事项

1. 需要编写的内容
   * 编写核心业务代码（目标类的目标方法）
   * 编写切面类，切面类中有通知（增强功能方法）
   * 在配置文件中，配置织入关系，即将那些通知与哪些连接点进行结合
2. AOP技术实现的内容
   * Spring框架监控切入点方法的执行。一旦监控到切入点方法被运行，使用代理机制，动态创建目标对象的代理对象，根据通知类别，在代理对象的对应位置，将通知对应的功能织入，完成完整的代码逻辑运行。
3. AOP底层使用那种代理方式
   * 在Spring中，框架会根据目标是否实现了接口来决定采用哪一种动态代理的方式。



# 基于XML的AOP开发

## 快速入门

1. 导入AOP相关坐标
2. 创建目标接口和目标类（内部有切点）
3. 创建切面类（内部有增强方法）
4. 将目标类和切面类的对象创建权交给Spring
5. 在applicationContext.xml中配置织入关系
6. 测试代码

## XML配置AOP详解

### 切点表达式的写法

*execution([修饰符] 返回值类型 包名.类名.方法名(参数)*

* 访问修饰符可以省略
* 返回值类型、包名、类名、方法名可以用通配符
* 包名与类名之间一个点.代表当前包下的类，两个点..标签当前包及其子包下的类
* 参数列表可以使用两个点..表示任一个数，任意类型的参数列表

*execution(public void makoto.aop.Target.method())*

*execution(void makoto.aop.Target.\*(..))*

*execution(\* makoto.aop.\*.\*(..))*   //最常用

*execution(\* makoto.aop..\*.\*(..))*

*execution(\* \*..\*.\*(..))*

### 通知的类型

1. 前置通知 \<aop:before>：用于配置前置通知。指定增强的方法在切入点之前执行
2. 后置通知 \<aop:after-returning>：用于配置后置通知。指定增强的方法在切入点之后执行
3. 环绕通知\<aop:around>：用于配置环绕通知。指定增强的方法在切入点之前和之后都执行
4. 异常抛出通知\<aop:after-throwing>：用于配置异常抛出通知。指定增强的方法在出现异常时执行
5. 最终通知\<aop:after>：用于配置最终通知。无论怎强方式执行是否有异常都会执行

### 切点表达式的抽取

当多个增强的切点表达式相同时，可以将切点表达式进行抽取，在增强中使用pointcut-ref属性代替pointcut属性来引用抽取后的切点表达式。

